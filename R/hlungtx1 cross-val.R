## practice n-fold validation
# full run using .8 training/testing ratio
require(caret)
require(stringr)
setwd("~/Desktop/sandbox")
hlungtx1 <- read.csv("~/Desktop/sandbox/hlungtx1_moses.csv")
rownames(hlungtx1) <- hlungtx1[,1]
hlungtx1[,1] <- NULL
setwd("~/github/mosesData/hlungtx1-8")
hlungtx1.test <- makeMpartitions(hlungtx1, p = .8)
hlungtx1.results <- runMfolder("-j4 -W1 -u controls -Y sample --hc-crossover=1 -m 500000 --enable-fs=1")
hlungtx1.rlist <- lapply(hlungtx1.results, Mout2str)
hlungtx1.scores <- Map(testCstring, hlungtx1.rlist, hlungtx1.test, conrat = .32)

# full run using .6 training/testing ratio
setwd("~/github/mosesData/hlungtx1-6")
hlungtx1.test <- makeMpartitions(hlungtx1, p = .6)
hlungtx1_hx6 <- runMfolder("-j4 -W1 -u controls -Y sample --hc-crossover=1 -m 500000 --enable-fs=1")
hlung_hx6 <- testClist(hlungtx1_sa6, hlungtx1.test, .32)
hlung_hx6.best <- bestCombos(hlung_hx6)

# > hlung_hx6.best
# $combo
# [1] "or(and($NM_004486_at $NM_005823_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at)"                                             
# [2] "and(or(and($NM_004486_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at) $NM_005823_at)"                                        
# [3] "or(and($NM_004486_at $NM_005823_at $NM_005826_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at)"                               
# [4] "and(or(and($NM_004486_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at) $NM_005813_at $NM_005823_at)"                          
# [5] "and(or(and($NM_004486_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at) $NM_005823_at !$NM_005832_at)"                         
# [6] "or(and(or($NM_005823_at !$NM_005828_at) $NM_004486_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at)"                          
# [7] "or(and(or($NM_005823_at !$NM_005836_at) $NM_004486_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at)"                          
# [8] "and(or(and($NM_004486_at !$NM_012384_at $XM_927968_at !$XM_945070_at !$XR_000538_at) $XM_945478_at) or($NM_005823_at !$NM_005829_at))"                     
# [9] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) !$XM_937648_at)"                             
# [10] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) !$XM_937098_at !$XM_937648_at)"              
# [11] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) $XM_937261_at !$XM_937648_at)"               
# [12] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) $XM_937521_at !$XM_937648_at)"               
# [13] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) $XM_937543_at !$XM_937648_at)"               
# [14] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at $XM_937334_at) !$XM_937648_at)"               
# [15] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) !$XM_937098_at $XM_937261_at !$XM_937648_at)"
# [16] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) !$XM_937098_at $XM_937521_at !$XM_937648_at)"
# [17] "or(and(or($NM_001003793_at !$XM_937409_at) or(!$NM_080803_at !$NM_153742_at) !$NM_001003828_at $NM_004486_at) !$XM_937098_at $XM_937543_at !$XM_937648_at)"
# 
# $rank
# [1]  0  0  0 -1 -1 -1 -1 -1  0  0  0 -1 -1 -1 -1 -1 -1
# 
# $score
# Accuracy AccuracyLower AccuracyUpper AccuracyNull AccuracyPValue Sensitivity
# C13 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C23 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C33 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C43 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C53 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C63 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C73 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C83 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C15 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C25 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C35 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C45 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C55 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C65 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C75 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C85 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C95 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# Specificity Pos Pred Value Neg Pred Value Prevalence Detection Rate
# C13   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C23   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C33   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C43   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C53   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C63   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C73   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C83   0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C15   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C25   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C35   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C45   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C55   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C65   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C75   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C85   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C95   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# Detection Prevalence
# C13            0.3684211
# C23            0.3684211
# C33            0.3684211
# C43            0.3684211
# C53            0.3684211
# C63            0.3684211
# C73            0.3684211
# C83            0.3684211
# C15            0.2631579
# C25            0.2631579
# C35            0.2631579
# C45            0.2631579
# C55            0.2631579
# C65            0.2631579
# C75            0.2631579
# C85            0.2631579
# C95            0.2631579
# 
# $features
# feature score   low combo
# 1      NM_004486_at     0 FALSE     1
# 2      NM_005823_at     0 FALSE     1
# 3      NM_012384_at     0  TRUE     1
# 4      XM_927968_at     0 FALSE     1
# 5      XM_945070_at     0  TRUE     1
# 6      XR_000538_at     0  TRUE     1
# 7      XM_945478_at     0 FALSE     1
# 17     NM_005826_at     0 FALSE     3
# 29     NM_005813_at    -1 FALSE     4
# 38     NM_005832_at    -1  TRUE     5
# 40     NM_005828_at    -1  TRUE     6
# 48     NM_005836_at    -1  TRUE     7
# 62     NM_005829_at    -1  TRUE     8
# 63  NM_001003793_at     0 FALSE     9
# 64     XM_937409_at     0  TRUE     9
# 65     NM_080803_at     0  TRUE     9
# 66     NM_153742_at     0  TRUE     9
# 67  NM_001003828_at     0  TRUE     9
# 69     XM_937648_at     0  TRUE     9
# 76     XM_937098_at     0  TRUE    10
# 84     XM_937261_at     0 FALSE    11
# 92     XM_937521_at    -1 FALSE    12
# 100    XM_937543_at    -1 FALSE    13
# 108    XM_937334_at    -1 FALSE    14

# full run using .6 training/testing ratio
setwd("~/github/mosesData/hlungtx1-sa8")
hlungtx1.test <- makeMpartitions(hlungtx1, p = .6)
hlungtx1_sa8 <- runMfolder("-j4 -W1 -u controls -Y sample --hc-crossover=1 -m 500000 --enable-fs=1")
hlung_sa8 <- testClist(hlungtx1_sa8, hlungtx1.test, .32)

# > hlung_sa6.best
# $combo
# [1] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_935558_at !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at) $NM_004486_at !$XM_938007_at)"                 
# [2] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_935559_at !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at) $NM_004486_at !$XM_938007_at)"                 
# [3] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_936233_at !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at) $NM_004486_at !$XM_938007_at)"                 
# [4] "and(or(and(or(and($XM_929239_at !$XM_946136_at) $XM_936897_at !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at) $NM_004486_at !$XM_938007_at)"                  
# [5] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at $XR_000222_at) $NM_004486_at !$XM_938007_at)"                  
# [6] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at !$XR_000297_at) $NM_004486_at !$XM_938007_at)"                 
# [7] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at $XR_000963_at) $NM_004486_at !$XM_938007_at)"                  
# [8] "and(or(and(or(and($XM_929239_at !$XM_946136_at) !$XM_946370_at) !$NM_019116_at $XM_927409_at !$XM_934742_at) !$XM_934717_at $XR_000968_at) $NM_004486_at !$XM_938007_at)"                  
# [9] "and(or(and($NM_004486_at $NM_015850_at !$XM_933006_at !$XR_000538_at) $NM_006159_at $NM_015352_at) $NM_023930_at)"                                                                         
# [10] "and(or(and($NM_004486_at $NM_015850_at !$XM_933006_at !$XR_000538_at) $NM_006159_at !$NM_016183_at) $NM_023930_at)"                                                                        
# [11] "and(or(and($NM_004486_at $NM_016203_at !$XM_933006_at !$XR_000538_at) $NM_006159_at !$NM_016183_at) $NM_023930_at)"                                                                        
# [12] "and(or(and($NM_004486_at !$XM_933006_at !$XR_000538_at) $NM_006159_at !$NM_016183_at) $NM_015850_at $NM_023930_at)"                                                                        
# [13] "or(and(or(and($NM_004486_at $NM_015850_at !$XM_933006_at !$XR_000538_at) $NM_006159_at) $NM_023930_at) $NM_015352_at)"                                                                     
# [14] "or(and(or(and($NM_004486_at $NM_015850_at !$XM_933006_at !$XR_000538_at) $NM_006159_at) $NM_023930_at) !$NM_016183_at)"                                                                    
# [15] "or(and(or(and($NM_004486_at $NM_015850_at !$XM_933006_at !$XR_000538_at) $NM_006159_at) $NM_023930_at) $NM_016220_at)"                                                                     
# [16] "and(or(and(or(!$NM_015170_at $NM_015850_at) $NM_004486_at !$XM_933006_at !$XR_000538_at) $NM_006159_at !$NM_016183_at) $NM_023930_at)"                                                     
# [17] "and(or(and(or($NM_015850_at $NM_016220_at) $NM_004486_at !$XM_933006_at !$XR_000538_at) $NM_006159_at !$NM_016183_at) $NM_023930_at)"                                                      
# [18] "and(or(and($NM_004486_at !$XM_933006_at !$XR_000538_at) $NM_006159_at !$NM_016183_at) or(!$NM_015324_at $NM_016215_at) $NM_023930_at)"                                                     
# [19] "and(or(and($NM_005848_at !$XM_936846_at !$XM_945070_at !$XM_946237_at) and(!$XM_932548_at $XR_000222_at)) or(!$NM_004031_at $NM_004037_at) $NM_000396_at $NM_004486_at)"                   
# [20] "and(or(and($NM_005848_at !$XM_945070_at !$XM_946237_at) and(!$XM_932548_at $XR_000222_at)) or(!$NM_004031_at $NM_004037_at) $NM_000396_at $NM_004486_at !$XM_936846_at)"                   
# [21] "and(or(and($NM_005848_at !$XM_945070_at !$XM_946237_at) and(!$XM_932548_at $XR_000222_at)) or(!$NM_004031_at $NM_004037_at) $NM_000396_at $NM_004486_at !$XM_936780_at !$XM_936846_at)"    
# [22] "and(or(and(or(!$XM_936835_at !$XM_936846_at) $NM_005848_at !$XM_945070_at !$XM_946237_at) and(!$XM_932548_at $XR_000222_at)) or(!$NM_004031_at $NM_004037_at) $NM_000396_at $NM_004486_at)"
# [23] "and(or(and($NM_005848_at !$XM_945070_at !$XM_946237_at) and(!$XM_932548_at $XR_000222_at)) or(!$NM_004031_at $NM_004037_at) or(!$XM_936846_at $XM_936897_at) $NM_000396_at $NM_004486_at)" 
# 
# $rank
# [1]  0 -1 -1 -1 -1 -1 -1 -1  0  0  0 -1 -1 -1 -1 -1 -1 -1  0  0  0 -1 -1
# 
# $score
# Accuracy AccuracyLower AccuracyUpper AccuracyNull AccuracyPValue Sensitivity
# C3   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C4   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C5   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C6   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C7   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C8   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C9   0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C10  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C14  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C24  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C34  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C44  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C54  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C64  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C74  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C84  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C94  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C104 0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   0.8333333
# C15  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C25  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C35  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C45  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# C55  0.9473684     0.7397193     0.9986684    0.6842105    0.007218811   1.0000000
# Specificity Pos Pred Value Neg Pred Value Prevalence Detection Rate
# C3     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C4     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C5     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C6     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C7     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C8     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C9     1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C10    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C14    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C24    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C34    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C44    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C54    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C64    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C74    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C84    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C94    1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C104   1.0000000      1.0000000      0.9272727       0.32      0.2631579
# C15    0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C25    0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C35    0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C45    0.9230769      0.8595041      1.0000000       0.32      0.3157895
# C55    0.9230769      0.8595041      1.0000000       0.32      0.3157895
# Detection Prevalence
# C3              0.2631579
# C4              0.2631579
# C5              0.2631579
# C6              0.2631579
# C7              0.2631579
# C8              0.2631579
# C9              0.2631579
# C10             0.2631579
# C14             0.2631579
# C24             0.2631579
# C34             0.2631579
# C44             0.2631579
# C54             0.2631579
# C64             0.2631579
# C74             0.2631579
# C84             0.2631579
# C94             0.2631579
# C104            0.2631579
# C15             0.3684211
# C25             0.3684211
# C35             0.3684211
# C45             0.3684211
# C55             0.3684211
# 
# $features
# feature score   low combo
# 1   XM_929239_at     0 FALSE     1
# 2   XM_946136_at     0  TRUE     1
# 3   XM_935558_at     0  TRUE     1
# 4   XM_946370_at     0  TRUE     1
# 5   NM_019116_at     0  TRUE     1
# 6   XM_927409_at     0 FALSE     1
# 7   XM_934742_at     0  TRUE     1
# 8   XM_934717_at     0  TRUE     1
# 9   NM_004486_at     0 FALSE     1
# 10  XM_938007_at     0  TRUE     1
# 13  XM_935559_at    -1  TRUE     2
# 23  XM_936233_at    -1  TRUE     3
# 33  XM_936897_at    -1 FALSE     4
# 48  XR_000222_at    -1 FALSE     5
# 58  XR_000297_at    -1  TRUE     6
# 68  XR_000963_at    -1 FALSE     7
# 78  XR_000968_at    -1 FALSE     8
# 82  NM_015850_at     0 FALSE     9
# 83  XM_933006_at     0  TRUE     9
# 84  XR_000538_at     0  TRUE     9
# 85  NM_006159_at     0 FALSE     9
# 86  NM_015352_at     0 FALSE     9
# 87  NM_023930_at     0 FALSE     9
# 93  NM_016183_at     0  TRUE    10
# 96  NM_016203_at     0 FALSE    11
# 129 NM_016220_at    -1 FALSE    15
# 130 NM_015170_at    -1  TRUE    16
# 151 NM_015324_at    -1  TRUE    18
# 152 NM_016215_at    -1 FALSE    18
# 154 NM_005848_at     0 FALSE    19
# 155 XM_936846_at     0  TRUE    19
# 156 XM_945070_at     0  TRUE    19
# 157 XM_946237_at     0  TRUE    19
# 158 XM_932548_at     0  TRUE    19
# 160 NM_004031_at     0  TRUE    19
# 161 NM_004037_at     0 FALSE    19
# 162 NM_000396_at     0 FALSE    19
# 183 XM_936780_at     0  TRUE    21
# 185 XM_936835_at    -1  TRUE    22

combo.v1m <- moses("-j2 -W1 -u controls -Y sample --hc-single-step=1 -m 100000 --enable-fs=1","hlungtx1_moses.csv")
combo.sa <- moses("-j2 -W1 -u controls -Y sample -a sa --enable-fs=1 -m 1000000 ","hlungtx1_moses.csv")   # run moses on 2 cores sa algo


